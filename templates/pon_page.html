{% extends "base.html" %}


    {% block title%}Оборудование{% endblock %}
    {% block scripts %}
        <script src="{{ url_for('static', filename='js/pon_page_scripts.js') }}"></script>
        <script src="{{ url_for('static', filename='js/bad_scripts.js') }}"></script>
        <script src="{{ url_for('static', filename='js/save_&_delete.js') }}"></script>
        <script src="{{ url_for('static', filename='js/pon_table_serch_script.js') }}"></script>
        <script src="{{ url_for('static', filename='js/for_ma_units_page_scripts.js') }}"></script>
    {% endblock %}


{% block sidebar%}
    <div class="col bg-dark-subtle" >
        <div class="container side_nav_bar" >
            <nav>
                <div class="row bg-light-subtle shadow_for_the_table" id="sidebar">
                    <header>
                        <h5 >Объекты:</h5>
                    </header>
                    <ul>
                        {% for u in ud %}
                        <li >
                            <a href="#ud-{{ u.number_ud }}-id">{{u.name}}</a>
                        </li>
                        {% endfor %}
                    </ul>

                </div>
            </nav>
        </div>
    </div>
{% endblock %}
{% block MainClass%} <main class="col-10 bg-body-tertiary"> {% endblock %}

{% block tableName %} <h1 class="h2">Оборудования PON</h1> {% endblock %}

{% block bigBtns%}
                    <button class="btn btn-primary btn-lg" data-bs-target="#setings_modal" data-bs-toggle="modal"
                            type="button">
                        <i class="bi bi-gear"></i>

                    </button>
                    <button class="btn btn-primary btn-lg" onclick="save_main_table_in_file()" type="button" data-toggle="tooltip" data-placement="top" title="Сохранить в файл">
                        <i class="bi bi-download"></i> Сохранить
                    </button>
{% endblock %}

{% block search %}
                    <input class="input_for_serch shadow_for_the_table" id="serch_pon_table" onkeyup="serch_pon_table()" placeholder="Поиск по таблице.."
                          type="text">
{% endblock %}
{% block mainTable%}
            <div class="table-responsive small">
                <table class="table table-sm table-borderless" id="main_pon_table">
                    {% for u in ud %}
                    <tbody class="ud_tbody block2 anchor_item"  id="ud-{{ u.number_ud }}-id">
                    <tr>
                        <td class="h5 " width='7%' >{{ u.name }}</td>
                        <td class="h5">адрес: {{ u.Adress }}</td>
                        <td width='2%'>
                            <a style="cursor: pointer;">
                                <img id="ud_add_un" data-id="{{u.id}}" data-cod="{{u.cod_ud}}"  data-bs-toggle="modal"
                                     data-toggle="tooltip" data-placement="top" title="Добавить новое устройство" data-bs-target="#add_new_unit_modal" src = "/static/images/add.svg"/>
                            </a>
                        </td>
<!--                        <td width='2%'>-->
<!--                            <a style="cursor: pointer;">-->
<!--                                <img id="ud_settings"  data-id="{{ u.id }}" data-toggle="tooltip" data-placement="top" title="Редактировать данные объекта"-->
<!--                                     data-bs-toggle="modal" data-bs-target="#edit_ud_data_modal" src = "/static/images/settings.svg"/>-->
<!--                            </a>-->
<!--                        </td>-->
                    </tr>
                    {% for olt in u.cod_name_of_olt |sort(attribute='cod_name_of_olt') %}

                    <tr >
                        <td  colspan='3' id="td_for_pon_mod">
                            <table class="table table-sm table-hover table-borderless scale">
                                <tbody class="shadow_for_the_table olt_tbody">
                                <tr class="shassi_row" data-id="{{ olt.id }}" data-db="List_of_olt">
                                    {% if (olt.id != 73) and (olt.id != 74) %}
                                    {% if olt and olt.type_of_olt == 4 %}
                                    <td class="h6" style="min-width: 3%; max-width: 5%"> NE </td>
                                    {% elif olt  %}
                                    <td class="h6" style="min-width: 3%; max-width: 5%"> OLT#{{ olt.OLT }}</td>
                                    {% else %}
                                    <td class="h6" style="min-width: 3%; max-width: 5%">  </td>
                                    {% endif %}
                                    <td class="h6" style="min-width: 7%; max-width: 12%"><a href=""
                                                                                            data-toggle="tooltip" data-placement="top" title="Данные об устройстве"
                                                                                            data-bs-toggle="modal" data-bs-target="#SostavModal"  data-pon ="{{ olt.id }}" > {{ olt.cod_name_of_olt }}</a></td>
                                    <td class="h6" style="min-width: 15%; max-width: 25%"> {{ olt.full_name }}</td>
                                    <td class="h6" width='18%'>s/n: {{ olt.serial_number }}</td>
                                    <td class="h6" >инв.№:  <a href=""
                                                               data-toggle="tooltip" data-placement="top" title="Данные инвентарного номера"
                                                               data-bs-toggle="modal" data-bs-target="#inventModal"  data-id = "{{ olt.inv_number }}" >{{ olt.inv_number }}</a></td>
                                    <td class="h6" width='10%'> IP: {{ olt.IP }}</td>
                                    <td class="h6" style="min-width: 3%; max-width: 9%"> Место: {{ olt.row_box_shelf }}</td>
                                    <td class="h6" width='5%'> {{ olt.note }}</td>
                                    <td width='2%'>
                                        <a style="cursor: pointer;">
                                            <img id="ud_add_mad" data-id="{{ olt.id}}" data-bs-toggle="modal" data-bs-target="#add_unit_data_modal"
                                                 data-toggle="tooltip" data-placement="top" title="Добавить модули" src = "/static/images/add.svg"/>
                                        </a>
                                    </td>
                                    <td width='2%'>

                                        <div class="d-grid gap-1 d-md-flex">
                                            <a class="btn btn-primary btn-sm" id="edir_olt_data_btn" data-id="{{olt.id}}"
                                               data-toggle="tooltip" data-placement="top" title="Переместить устройство"
                                               data-db="Uzel_dostupa_all" data-bs-toggle="modal" data-bs-target="#move_olt_Modal">
                                                <i class="bi bi-box-arrow-up-right"></i>
                                            </a>
                                        </div>

                                    </td>
                                    {% else %}
                                    <td class="h6" width='100%'> {{ olt.cod_name_of_olt }}</td>
                                    <td width='2%'>
                                        <a style="cursor: pointer;">
                                            <img id="shelf_add_mad" data-id="{{ olt.id}}"
                                                 data-toggle="tooltip" data-placement="top" title="Добавить модули"
                                                 data-bs-toggle="modal" data-bs-target="#add_shelf_data_modal" src = "/static/images/add.svg"/>
                                        </a>
                                    </td>
                                    {% endif %}
                                </tr>
                                <tr class="platy_row">
                                    <td  colspan='10'>
                                        <table class="table table-sm table-bordered table-hover table-sort ">
                                            <thead>
                                            <tr>
                                                <td width='2%'>
                                                    <a style="cursor: pointer;">
                                                        <img class="svg" id="colaps_olt" data-status="minus" src = "/static/images/stat_minus_.svg"/>
                                                    </a>
                                                </td>
                                                <td scope="col" width='2%'> №</td>
                                                <td scope="col" width='11%'> Тип</td>
                                                <td scope="col" width='30%'> Наименование</td>
                                                <td scope="col" width='20%'> Зоводской номер</td>
                                                <td scope="col"  width='15%'> Инвентарный</td>
                                                <td scope="col" width='20%'> Примечание</td>
                                                <td width='2%'></td>
                                            </tr>
                                            </thead>
                                            <tbody class="plata_tbody">
                                            {% for m in olt.list_of_modules | sort(attribute = olt.list_of_modules.type_of_modules)|sort(attribute='socket')%}
                                            <tr class="for_file_download" data-id="{{ m.id }}" data-db="List_of_modules" bgcolor="{{m.color}}">
                                                <td width='2%' data-id="{{ m.id }}">
                                                    <input class="form-check-input" id="flexCheck_modul{{ m.id }}" type="checkbox"  value="">
                                                </td>
                                                {% if m.Olt_sockets.socket == -1  %}
                                                <td >fan</td>

                                                {% else %}
                                                <td > {{ m.Olt_sockets.socket }}</td>
                                                {% endif %}
                                                <td > {{ m.type_of_modules }}</td>
                                                <td > {{ m.name_of_modules }}</td>
                                                <td > {{ m.serial_number }}</td>
                                                <td><a href="" data-bs-toggle="modal" data-bs-target="#inventModal"  data-id = "{{ m.inv_number }}" > {{ m.inv_number }}</a></td>
                                                <td > {{ m.note }}</td>
                                                <td >
                                                    <div class="d-grid gap-1 d-md-flex">
                                                        <a class="btn btn-primary btn-sm" id="edir_row_data_btn" data-id="{{m.id}}"
                                                           data-toggle="tooltip" data-placement="top" title="Редактировать данные"
                                                           data-db="list_of_modules" data-bs-toggle="modal" data-bs-target="#edit_row_data_modal">
                                                            <i class="bi bi-pen"></i>
                                                        </a>
                                                        <a class="btn btn-primary btn-sm" id="move_item_btn" data-id="{{m.id}}"
                                                           data-toggle="tooltip" data-placement="top" title="Переместить модуль"
                                                           data-bs-toggle="modal" data-db="list_of_modules" data-bs-target="#move_obj_Modal">
                                                            <i class="bi bi-box-arrow-up-right"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    {% endfor %}
                </table>
            </div>
{% endblock %}
{% block sidecolum_right%}
<div class="col bg-dark-subtle" >

</div>
{% endblock %}
{% block addScripts%}
<script>
    let serch_line = document.getElementById('serch_pon_table').classList
    let active_class = "serch_scrolled"
    window.addEventListener('scroll', e => {
        pageYOffset > 111.1? serch_line.add(active_class):serch_line.remove(active_class)
    });
    // document.querySelectorAll('td').forEach(td => {
    //     td.ondblclick = function () {
    //         this.contentEditable = true;
    //     };
    // });
    [].forEach.call(document.getElementsByClassName('svg'), function (col) {
        col.addEventListener("click", function () {
            this.dataset.status === 'minus'? colaps_olt_tbody(true, this):colaps_olt_tbody(false, this);})
    })
    document.getElementById('flexCheck_main').addEventListener("change", function () {
        if (this.checked) {
            check_all_visible_PON_table(true)
        } else {
            check_all_visible_PON_table(false);
        }
    });
    document.getElementById('flexSwitchCheckChecked').addEventListener("change", function () {
        if (this.checked) {
            show_checked_PON_table(true)
        } else {
            show_checked_PON_table(false);
        }
    });
    document.getElementById('favcolor').addEventListener("change", function () {
        console.log(this.value)
        set_custom_bg_color_PON_table(true, this.value)
        this.value=''
    });
    document.getElementById('defolt_color').addEventListener("click", function () {
        console.log(this.value)
        set_custom_bg_color_PON_table(false)
    });
    // {# document.getElementById('delete_checked').addEventListener("click", function (e) {
    //     e.preventDefault();
    //     let table = document.getElementById('tbody_main_table');
    //     let tr = table.getElementsByTagName('tr');
    //     if (confirm('Удалить выбранные данные?')) {
    //         for (var i = 0; i < tr.length; i++) {
    //             tds = tr[i].getElementsByTagName('td');
    //             if (tds[0].querySelector('.form-check-input').checked === true) {
    //                 delete_row_list('Unit', tds[0].dataset.id, tr[i])
    //             }
    //         }
    //     }
    // }); #}
</script>
{% endblock %}


{% block modals%}
<div class="modal fade" id="edit_row_data_modal" data-bs-backdrop="static" role="dialog" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EditModalLabel">Изменение данных об устройстве   </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" ></button>
            </div>
            <div class="modal-body">
                <form>
                    <label class="col-form-label" id="id_for_edit"></label>
                    <div class="container">
                        <div class="row" id="first_row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Наименование:</label>
                                    <input type="text"  class="form-control" id="edit_Name_id">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="row" id="second_row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Серийный номер:</label>
                                    <input type="text"  class="form-control" id="edit_Serial_id">
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Инвентарный номер:</label>
                                    <input type="text"  class="form-control" id="edit_Inv_id">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label  class="col-form-label">Примечание:</label>
                            <textarea  class="form-control" id="unit_note_id" cols="30" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="button_for_save_edit_row" name="button_for_save_edit_row" data-toggle="tooltip" data-placement="top" title='Сохранить изменения'>Сохранить</button>
                <button type="button" class="btn btn-primary" id="button_for_delete_row" data-toggle="tooltip" data-placement="top" title='Удалить модуль'>Удалить</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btn_cls_edit_mod">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="inventModal" data-bs-backdrop="static" role="dialog" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inventModalLabel">Карточка устройства</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <label class="col-form-label" id="id_buh"></label>
                    <div class="container">
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Инвентарный номер:</label>
                                    <input type="text" readonly class="form-control" name="name" id = "In_num">
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">МОЛ:</label>
                                    <select class="form-select" aria-label="Default select example" id = 'select_mol_id'>
                                        {% for mol in mols %}
                                        <option value="{{ mol.id }}">{{ mol.full_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="col-form-label">Краткое описание:</label>
                        <input type="text"  class="form-control" id="description_id">
                    </div>
                    <div class="mb-3">
                        <label  class="col-form-label">Характеристика:</label>
                        <textarea  class="form-control" id="char_id" cols="30" rows="7"></textarea>
                    </div>
                    <div class="mb-3">
                        <label  class="col-form-label">Примечание:</label>
                        <textarea  class="form-control" id="note_id" cols="30" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id = "button_for_save_edit_buh_data" onclick="save_edit_buh_data()" data-toggle="tooltip" data-placement="top" title="Записать изменения">Сохранить</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="SostavModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Состав Оборудования</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"  ></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="container">
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Место расположения:</label>
                                    <input type="text" readonly class="form-control" id="Ud_id" >
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">IP  адрес:</label>
                                    <input type="text"  class="form-control" id="ip_id">
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">№ OLT:</label>
                                    <input type="text"  class="form-control" id="olt_id" >
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Инвентарный номер:</label>
                                    <input type="text"  class="form-control" id="inv_id" >
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Устройство:</label>
                                    <input type="text"  class="form-control" id="PON_id" >
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Заводской номер:</label>
                                    <input type="text"  class="form-control" id="serial_id" >
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Дата выпуска:</label>
                                    <input type="text"  class="form-control" id="date_pr_id"  >
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Дата ввода в экспуатацию:</label>
                                    <input type="text"  class="form-control"  id="date_exp_id">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Наименование:</label>
                                    <input type="text"  class="form-control" id="full_name_id" name="name2">
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Ряд/Шкаф/Полка:</label>
                                    <input type="text"  class="form-control" id="mesto_id" >
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Завод изготовитель:</label>
                                    <input type="text"  class="form-control" id="zavod_id" >
                                </div>
                            </div>
                            <div class="col-sm custom-footer" >


                                <button type="button" class="btn btn-primary" id = "save_kts"  data-toggle="tooltip" data-placement="top" title='Сохранить изменения'>
                                    <i class="bi bi-floppy"></i>
                                </button>
                                <button type="button" class="btn btn-primary" id = "del_pon_unit"  data-toggle="tooltip" data-placement="top" title='Удалить устройство'>
                                    <i class="bi bi-trash3"></i>
                                </button>

                            </div>
                        </div>
                    </div>
                    <div class="table-responsive small">
                        <table class="table table-striped table-sm table-bordered table-sort table-hover" id="Sostav_Modal_table">
                            <thead>
                            <tr>
                                <th scope="col">П/М</th>
                                <th scope="col">Инвентарный номер</th>
                                <th scope="col">Наименование оборудования</th>
                                <th scope="col">Заводской номер</th>
                                <th scope="col">Примечание</th>
                            </tr>
                            <tr>
                                <th scope="col">1</th>
                                <th scope="col">2</th>
                                <th scope="col">3</th>
                                <th scope="col">4</th>
                                <th scope="col">5</th>
                            </tr>
                            </thead>
                            <tbody id="t_sostav_body"></tbody>
                        </table>
                    </div>
                </form>
            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-primary" id = "kts"  data-toggle="tooltip" data-placement="top" title='Скачать КТС'>КТС</button>
                <button type="button" class="btn btn-primary" id = "sostav"  data-toggle="tooltip" data-placement="top" title='Скачать Состав оборудования'>Состав оборудования</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btn_cls_sostav">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="move_obj_Modal"  data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable ">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" >Перемещение</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                <label class="col-form-label">Куда переместить:  <i>(склад\зип)</i></label>
                                <select class="form-select" aria-label="Default select example" id = 'select_unit'>
                                    <option selected value="0">Устройство</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                <label class="col-form-label">Плато-место: <i>(стелаж)</i></label>
                                <select class="form-select" aria-label="Default select example" id = 'select_socket' disabled>
                                    <option selected value="0">Выберите место</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-bs-dismiss="modal" class="btn btn-secondary" id="close_mv_mod_btn">Закрыть</button>
                <button type="button" class="btn btn-primary" id="apply_move_modul_btn" >Применить</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="move_olt_Modal"  data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" >Перемещение</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <form>
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Куда переместить:</label>
                                    <select class="form-select" aria-label="Default select example" id = 'select_ud'>
                                        <option selected value="0">Выберите объект</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Имя устройства: <i>(уникальное!)</i></label>
                                    <input type="text"  class="form-control" id="cod_to_mv">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">IP адрес:</label>
                                    <input type="text"  class="form-control" id="new_IP">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm">
                                <div class="mb-3">
                                    <label class="col-form-label">Место:</label>
                                    <input type="text"  class="form-control" id="new_mesto">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="apply_move_olt_btn" >Применить</button>
                <button type="button" data-bs-dismiss="modal" class="btn btn-secondary" id="close_mv_olt_btn">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="add_unit_data_modal" data-bs-backdrop="static" tabindex="-1"  aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" >Добавить новые модули к устройству</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"  ></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive small">
                    <table class="table table-striped table-sm table-bordered table-sort table-hover" id="table_add_to_un">
                        <thead>
                        <tr>
                            <th scope="col"></th>
                            <th scope="col">П/М</th>
                            <th scope="col">Тип</th>
                            <th scope="col">Инвентарный номер</th>
                            <th scope="col">Наименование оборудования</th>
                            <th scope="col">Заводской номер</th>
                        </tr>
                        </thead>
                        <tbody id="t_body_add_to_un"></tbody>
                    </table>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id = "save_new_modules"  data-toggle="tooltip" data-placement="top" title='Сохранить изменения'>
                    <i class="bi bi-floppy"></i>
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cl_add_pon_mod">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="add_shelf_data_modal" data-bs-backdrop="static" tabindex="-1"  aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" >Добавить новые модули на стелаж</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"  ></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive small">
                    <table class="table  table-sm table-bordered table-hover" id="table_add_to_shelf">
                        <thead>
                        <tr>
                            <th scope="col">Тип устройсва</th>
                            <th scope="col">Тип модуля</th>
                            <th scope="col">Наименование оборудования</th>
                            <th scope="col">Заводской номер</th>
                            <th scope="col">Инвентарный номер</th>
                        </tr>
                        </thead>
                        <tbody id="t_body_add_to_shelf"></tbody>
                    </table>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-primary btn-sm" id="add_new_row"  data-toggle="tooltip" data-placement="top" title='Добавить строку для нового устройства'>
                        <i class="bi bi-plus-lg"></i></button>
                    <button type="button" class="btn btn-primary btn-sm" id="rmv_lst_row" data-toggle="tooltip" data-placement="top" title='Удалить строку'>
                        <i class="bi bi-dash-lg"></i></button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id = "save_new_modules_shelf"  data-toggle="tooltip" data-placement="top" title='Сохранить'>
                    <i class="bi bi-floppy"></i>
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cl_new_pon_mod">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="add_new_unit_modal" data-bs-backdrop="static" tabindex="-1"  aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-l">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" >Добавить новое устройство</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"  ></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                <label class="col-form-label">тип устройства:</label>
                                <select class="form-select" aria-label="Default select example" id = 'select_type_unit'>
                                    <option value = '0'>Выберите тип устройства</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                <label class="col-form-label">Имя устройства: <i>(уникальное!)</i> </label>
                                <input type="text" readonly class="form-control" id="cod_new_un" >
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                <label class="col-form-label">IP адрес:</label>
                                <input type="text" readonly class="form-control" id="ip_new_un" >
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="mb-3">
                                <label class="col-form-label">Место установки:</label>
                                <input type="text" readonly class="form-control" id="mecto_new_un" >
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id = "save_new_unit"  data-toggle="tooltip" data-placement="top" title='Сохранить изменения'>
                    <i class="bi bi-floppy"></i>
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cl_add_pon_un">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="setings_modal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" >Оборудования PON</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"  ></button>
                </div>
                <div class="modal-body">
                    <nav aria-label="breadcrumb" >
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item active" onclick="settings_obj_data();">Объекты</li>
                            <li class="breadcrumb-item"  onclick="settings_unit_data();"><a href="#">Устройства</a></li>
                        </ol>
                    </nav><br>
                    <form id="form_settings_obj_data">


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btn_cls_settings" onclick="reload_page()">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block modalScripts%}
<script>
    $('#setings_modal').on('show.bs.modal', function (e) {
        // $(this).find('form').trigger('reset');
        // settings_obj_data()
    })
    $('#add_new_unit_modal').on('show.bs.modal', function (e) {
        $(this).find('form').trigger('reset');
        add_new_unit($(e.relatedTarget).data('id'),$(e.relatedTarget).data('cod'));
    })
    $('#add_shelf_data_modal').on('show.bs.modal', function (e) {
        shelf_new_modules($(e.relatedTarget).data('id'));
    })
    $('#add_unit_data_modal').on('show.bs.modal', function (e) {
        add_new_unit_data($(e.relatedTarget).data('id'));
    })
    // Модульное окно перемещения оборудования
    $('#move_obj_Modal').on('show.bs.modal', function (e) {
        move_modul_modal($(e.relatedTarget).data('id'));
    })
    $('#move_olt_Modal').on('show.bs.modal', function (e) {
        $(this).find('form').trigger('reset');
        move_olt_modal($(e.relatedTarget).data('id'));
    })
    // Заполнение модульного окна данных инвентарного номера
    $('#inventModal').on('show.bs.modal', function (e) {
        $(this).find('form').trigger('reset');
        let param2 = e.relatedTarget.dataset.id
        let user = {{user_name | tojson}}
        invent_modal(param2, user);
    })
    // Заполнить таблицу в модульном окне Соства оборудования
    $('#SostavModal').on('show.bs.modal', function (e) {
        $(this).find('form').trigger('reset');
        var dataPon = $(e.relatedTarget).data('pon')
        to_fill_sostav_modal(dataPon, e.relatedTarget.closest('tr'))})

    // заполнение модульного окна для редактирования записи UNITS
    $('#edit_row_data_modal').on('show.bs.modal', function (e) {
        $(this).find('form').trigger('reset');
        to_fill_edit_modal($(e.relatedTarget).data('id'), $(e.relatedTarget).data('db'),(e.relatedTarget).closest('tr'))
    });
    $('#edit_ud_data_modal').on('show.bs.modal', function (e) {
        $(this).find('form').trigger('reset');
        to_fill_ud_edit_modal($(e.relatedTarget).data('id'),(e.relatedTarget).closest('tr'))
    });
</script>
{% endblock %}





